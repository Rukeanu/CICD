# Basic CI/CD

## Part 1. Настройка **gitlab-runner**

#### Подними виртуальную машину *Ubuntu Server 22.04 LTS*.
*Будь готов, что в конце проекта нужно будет сохранить дамп образа виртуальной машины.*

1. Поднял Ubuntu Server 22.04 LTS

![версия ubuntu](screenshots/1.1.png)

#### Скачай и установи на виртуальную машину **gitlab-runner**.

2. Скачал и установил командами `curl -L "https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh" | sudo bash` и `sudo apt-get install gitlab-runner`

#### Запусти **gitlab-runner** и зарегистрируй его для использования в текущем проекте (*DO6_CICD*).
- Для регистрации понадобятся URL и токен, которые можно получить на страничке задания на платформе.

3. Запустил и зарегестрировал командами `sudo gitlab-runner start` и `sudo gitlab-runner register`

![регистрация gitlab-runner](screenshots/1.2.png)


## Part 2. Сборка

#### Напиши этап для **CI** по сборке приложений из проекта *C2_SimpleBashUtils*.
#### В файле _gitlab-ci.yml_ добавь этап запуска сборки через мейк файл из проекта _C2_.
#### Файлы, полученные после сборки (артефакты), сохрани в произвольную директорию со сроком хранения 30 дней.

![настроенный gitlab-ci.yml](screenshots/2.1.png)


## Part 3. Тест кодстайла

#### Напиши этап для **CI**, который запускает скрипт кодстайла (*clang-format*).

![](screenshots/3.1.png)

![](screenshots/3.2.png)

![](screenshots/3.3.png)

#### Если кодстайл не прошел, то «зафейли» пайплайн.

![](screenshots/3.4.png)

#### В пайплайне отобрази вывод утилиты *clang-format*.

![](screenshots/3.5.png)

## Part 4. Интеграционные тесты

#### Напиши этап для **CI**, который запускает твои интеграционные тесты из того же проекта.

1. написал

![](screenshots/4.1.png)

#### Запусти этот этап автоматически только при условии, если сборка и тест кодстайла прошли успешно.
#### Если тесты не прошли, то «зафейли» пайплайн.



#### В пайплайне отобрази вывод, что интеграционные тесты успешно прошли / провалились.

![](screenshots/4.3.png)

## Part 5. Этап деплоя

`-` Для завершения этого задания ты должен перенести исполняемые файлы на другую виртуальную машину, которая будет играть роль продакшна. Удачи.

**== Задание ==**

#### Подними вторую виртуальную машину *Ubuntu Server 22.04 LTS*.

1. Поднял и настроил

#### Напиши этап для **CD**, который «разворачивает» проект на другой виртуальной машине.

2. Написал этап деплоя

#### Запусти этот этап вручную при условии, что все предыдущие этапы прошли успешно.

3. Добавил условие запуска manual

#### Напиши bash-скрипт, который при помощи **ssh** и **scp** копирует файлы, полученные после сборки (артефакты), в директорию */usr/local/bin* второй виртуальной машины.

4. Написал скрипт

#### В файле _gitlab-ci.yml_ добавь этап запуска написанного скрипта.

5. Добавил

#### В случае ошибки «зафейли» пайплайн.

В результате ты должен получить готовые к работе приложения из проекта *C2_SimpleBashUtils* (s21_cat и s21_grep) на второй виртуальной машине.

#### Сохрани дампы образов виртуальных машин.
**P.S. Ни в коем случае не сохраняй дампы в гит!**
- Не забудь запустить пайплайн с последним коммитом в репозитории.


## Part 6. Дополнительно. Уведомления

`-` Здесь написано, что твое следующее задание выполняется специально для нобелевских лауреатов. Здесь не сказано, за что они получили премию, но точно не за умение работать с **gitlab-runner**.

**== Задание ==**

##### Настрой уведомления о успешном/неуспешном выполнении пайплайна через бота с именем «[твой nickname] DO6 CI/CD» в *Telegram*.

- Текст уведомления должен содержать информацию об успешности прохождения как этапа **CI**, так и этапа **CD**.
- В остальном текст уведомления может быть произвольным.